<!-- #layout name=empty -->
<div class="page-loading" style="display: none;">
    <div class="content">
        <p><i class="fa fa-spinner fa-spin"></i> <span>Logging in...</span></p>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
            <div class="block-small-form">
                <div class="logo">
                    <img src="/_admin/Images/logo-blue.png" alt="Logo">
                </div>
                <div class="tab-content">
                    <div id="tab_account_login" class="tab-pane fade active in">

                        <form @submit.prevent='onLogin'>
                            <div class="form-group" :class="{ 'has-error': !username.isValid }">
                                <label class="sr-only">Username</label>
                                <input class="form-control" type="text" v-validate='username' placeholder="Username" />
                                <span class="help-block" v-for='error in username.errors' v-text='error'></span>
                            </div>
                            <div class="form-group" :class="{ 'has-error': !password.isValid }">
                                <label class="sr-only">Password</label>
                                <input class="form-control" type="password" v-validate='password' placeholder="Password" />
                                <span class="help-block" v-for='error in password.errors' v-text='error'></span>
                            </div>
                            <div class="form-group">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" v-model='remember' />Keep me signed in</label>
                                </div>
                            </div>
                            <button class="btn blue" type="submit">Sign in</button>
                            <p>
                                <a :href='forgotPasswordUrl'>Forgot password?</a>
                            </p>
                            <p>
                                <span>Do not have an account?</span> <a :href='registerUrl'>Create an account</a>
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/_Admin/Scripts/vue/vue.js"></script>
<script src="/_Admin/Scripts/vue/directives/validate.js"></script>
<script>
    var app = new Vue({
        el: '.container',
        data: {
            username: {
                value: '',
                validate: {
                    rules: [{
                        type: 'required'
                    }]
                },
                isValid: true,
                errors: []
            },
            password: {
                value: '',
                validate: {
                    rules: [{
                        type: 'required'
                    }]
                },
                isValid: true,
                errors: []
            },
            remember: false,

            forgotPasswordUrl: Kooboo.Route.User.ForgotPassword,
            registerUrl: Kooboo.Route.User.RegisterPage
        },
        methods: {
            isValid: function() {
                return this.$data.username.isValid && this.$data.password.isValid;
            },
            onLogin: function() {
                if (this.isValid()) {
                    Kooboo.User.login({
                        username: this.$data.username.value,
                        password: this.$data.password.value,
                        remember: this.$data.remember
                    }).then(function(res) {
                        if (res.success) {
                            location.href = res.model
                        }
                    })
                }
            }
        }
    })
</script>
<!-- <script>
    $(function() {

        var loginViewModel = function() {
            var self = this;

            self.username = ko.validateField({
                required: Kooboo.text.validation.required
            });

            self.password = ko.validateField({
                required: Kooboo.text.validation.required
            });

            self.remember = ko.observable();

            self.showError = ko.observable(false);

            self.isValid = function() {
                if (!self.username()) {
                    self.username("");
                }

                if (!self.password()) {
                    self.password("");
                }

                return self.username.isValid() && self.password.isValid();
            };

            self.onLogin = function() {
                if (self.isValid()) {
                    self.showError(false);

                    Kooboo.User.login({
                        username: self.username(),
                        password: self.password(),
                        remember: self.remember(),
                        returnUrl: Kooboo.getQueryString("returnurl"),
                        type: Kooboo.getQueryString("type")
                    }).then(function(res) {
                        if (res.success) {
                            location.href = res.model;
                        }
                    });

                } else {
                    self.showError(true);
                }
            }


            self.forgotPasswordUrl = Kooboo.Route.Get(Kooboo.Route.User.ForgotPassword);

            self.registerUrl = ko.pureComputed(function() {
                return Kooboo.Route.User.RegisterPage;
            })
        };

        var login = new loginViewModel();
        ko.applyBindings(login, document.getElementsByClassName("container")[0]);
    });
</script> -->